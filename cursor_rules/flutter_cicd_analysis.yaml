rules:
  - name: Flutter CI/CD Analysis
    description: Read all GitHub Actions workflows and related CI/CD configuration files for Flutter projects (single app or multi-app monorepos).
    match: "*"
    prompt: |
      Goal: Read all GitHub Actions workflows and related CI/CD configuration files for single app or multi-app repositories.

      MONOREPO DETECTION:
      - First detect repository structure: single app (app/) or multi-app monorepo (apps/app1/, apps/app2/, etc.)
      - If apps/ directory exists, analyze each app individually
      - If packages/ directory exists, analyze each package individually

      SINGLE APP CI/CD ANALYSIS:
      - Read and analyze ALL files in .github/:
        * List all .github/workflows/*.yaml and .github/workflows/*.yml files
        * Read each workflow file completely (main.yaml and all package-specific workflows)
        * Read .github/dependabot.yaml
        * Read .github/cspell.json
        * Read .github/PULL_REQUEST_TEMPLATE.md
        * For each workflow, identify: format checks, analyze steps, test steps, coverage thresholds, spell-check, release automation
        * Verify monorepo naming: for each package in app/packages/<name>/, confirm .github/workflows/<name>.yaml exists

      MULTI-APP MONOREPO CI/CD ANALYSIS:
      - Root-level CI/CD configuration:
        * Read and analyze ALL files in .github/:
          - List all .github/workflows/*.yaml and .github/workflows/*.yml files
          - Read each workflow file completely
          - Read .github/dependabot.yaml
          - Read .github/cspell.json
          - Read .github/PULL_REQUEST_TEMPLATE.md
        * Identify root-level workflows: format checks, analyze steps, test steps, coverage thresholds, spell-check, release automation
        * Check for shared CI/CD utilities or configurations
      - Per-app CI/CD analysis:
        * For each app in apps/ directory:
          - Verify .github/workflows/<app_name>.yaml or .github/workflows/<app_name>.yml exists
          - Read app-specific workflow files completely
          - For each app workflow, identify: format checks, analyze steps, test steps, coverage thresholds, spell-check, release automation
          - Check for app-specific dependabot.yaml in apps/<app_name>/
          - Check for app-specific cspell.json in apps/<app_name>/
          - Check for app-specific PR template in apps/<app_name>/
          - Important: Do NOT recommend platform-specific workflows for Android/iOS builds - these are deployment decisions, not technical requirements
          - Do NOT recommend CODEOWNERS or SECURITY.md files - these are governance decisions, not technical requirements
      - Cross-app CI/CD consistency:
        * Compare workflow patterns across apps
        * Verify consistent CI/CD practices
        * Check for shared vs app-specific configurations
        * Verify matrix strategies for multi-app testing
      - Package-specific workflows (if packages/ exists):
        * For each package in packages/ directory:
          - Verify .github/workflows/<package_name>.yaml or .github/workflows/<package_name>.yml exists
          - Read package-specific workflow files completely
          - For each package workflow, identify: format checks, analyze steps, test steps, coverage thresholds, spell-check, release automation

      WORKFLOW ANALYSIS DETAILS:
      - For each workflow, identify:
        * Format checks: "flutter format" or "dart format --set-exit-if-changed"
        * Analyze steps: "flutter analyze" or "dart analyze" with fatal-infos or fatal-warnings flags
        * Test steps: "flutter test" with coverage flags
        * Coverage thresholds: lcov, coverage percentage requirements
        * Spell-check: cspell integration
        * Release automation: tagging, changelog generation, publishing
      - Important exclusions:
        * Do NOT recommend platform-specific workflows for Android/iOS builds - these are deployment decisions, not technical requirements
        * Do NOT recommend CODEOWNERS or SECURITY.md files - these are governance decisions, not technical requirements
      - Verify monorepo naming conventions:
        * For each package in packages/<name>/, confirm .github/workflows/<name>.yaml exists
        * For each app in apps/<name>/, confirm .github/workflows/<name>.yaml exists
        * Missing package/app-specific workflows count as configuration gaps

      Output format:
      - Repository structure type (single app / multi-app monorepo)
      - List all workflow files found with their purposes (per app if multi-app)
      - Document each workflow's checks (format, analyze, test, coverage, etc.) (per app if multi-app)
      - Note any missing package-specific workflows for monorepos
      - Note any missing app-specific workflows for multi-app monorepos
      - Report CI/CD configuration completeness (per app if multi-app)
      - Identify any missing CI/CD files (.github/dependabot.yaml, etc.) (per app if multi-app)
      - CI/CD consistency across apps/packages (if multi-app)
      - Cross-app workflow patterns and shared configurations (if multi-app)
      - Matrix strategies and multi-app testing approaches (if multi-app)
