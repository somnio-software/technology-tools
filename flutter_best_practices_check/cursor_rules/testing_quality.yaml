rules:
  - name: Flutter Testing Quality Analysis
    description: Analyze testing code quality, naming conventions, and best practices (assertions, mocks, structure) based on somnio-software standards.
    match: "**/*_test.dart"
    prompt: |
      Goal: Analyze the quality, structure, and best practices of Flutter test files.

      STANDARDS SOURCE:
      - Validates against: `https://raw.githubusercontent.com/somnio-software/cursor-rules/main/.cursor/rules/flutter/flutter-testing.mdc`
      - Validates against: `https://raw.githubusercontent.com/somnio-software/cursor-rules/main/.cursor/rules/flutter/bloc-test.mdc`
      
      INSTRUCTIONS:
      1. USE the `read_url_content` tool to fetch the latest standards from the URLs above.
      2. Proceed with the analysis below using strict adherence to those rules.

      ANALYSIS TARGETS:
      1.  **Test Naming Conventions**:
          *   Check for verbose, descriptive names (e.g., 'renders $WidgetName when state is X' vs 'renders').
          *   Ensure names explain the "what" and "when".

      2.  **Assertion Quality**:
          *   Check for specific matchers (e.g., `expect(list, contains(item))` instead of `expect(list.contains(item), true)`).
          *   Verify EVERY test has at least one assertion (`expect` or `verify`).
          *   Flag tests with no assertions (pass-through tests).

      3.  **Test Structure & Atomicity**:
          *   **Single Purpose**: Check that tests verify one concept per test case.
          *   **Grouping**: Verify usage of `group()` to organize tests (e.g., by method or widget).
          *   **Setup/Teardown**: Ensure `setUp` and `tearDown` are used within groups, not globally if possible.
          *   **Mocking**: Check for usage of private mocks (e.g., `class _MockRepo extends Mock...`) to avoid namespace pollution.

      4.  **Bloc Testing Specifics (if bloc_test imported)**:
          *   Verify Structure: `group('BlocName')` -> `group('EventName')` -> `blocTest`.
          *   Check for `build` function usage.
          *   Ensure `act` and `expect` are present.
          *   Verify repository interactions are verified if dependencies exist.

      5.  **Widget Testing Specifics**:
          *   Check for `find.byType()` usage over `find.byKey()` where appropriate (less brittle).
          *   Verify `pump()` or `pumpAndSettle()` usage patterns.

      OUTPUT FORMAT:
      *   **Overview**: Total tests analyzed, quality score (1-10).
      *   **Violations**: List specific file paths and lines violating the above rules.
          *   Format: `[File](path) : [Line] - [Issue Description]`
      *   **Compliance**: Highlight good examples found in the codebase.
      *   **Recommendations**: Specific refactoring suggestions for violations.
